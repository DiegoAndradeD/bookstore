<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
</head>
<body>
    <nav class="navbar bg-dark navbar-dark navbar-expand-sm py-3">
        <div class="container">
            <a href="/index" class="navbar-brand d-flex align-items-center">BlogProject</a>
    
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#menuNavbar">
                <span class="navbar-toggler-icon"></span>
            </button>
    
            <div class="collapse navbar-collapse" id="menuNavbar">
                <div class="navbar-nav ms-auto">
                    <a href="/index" class="nav-link">HomePage</a>
                    <a href="/signupPrototype" class="nav-link">Signup</a>
                    <a href="/help" class="nav-link">Help</a>
    
                    <% if (email) { %>
                    <div class="dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"><%= email %></a>
                            <li><a href="/logout" class="dropdown-item">Logout</a></li>
                        </ul>
                    </div>
                    <% } else { %>
                    <a href="/loginPrototype" class="nav-link">Login</a>
                    <% } %>
                </div>
            </div>
        </div>
    </nav>

    <main>

        <div class="loginContainer d-flex align-items-center justify-content-center ">
            <div class="loginArea p-4 rounded-3" style="background-color: var(--color7);">
                <form action="/loginPrototype" method="post">
                    <div class="mb-3">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" name="email" id="email" class="form-control" required minlength="4" placeholder="Email" autocomplete="off" autofocus>
                    </div>
                    <div class="mb-3">
                        <label for="password" class="form-label">Password</label>
                        <input type="password" name="password" id="password" class="form-control" required minlength="6" maxlength="20" placeholder="Email" autocomplete="off" autofocus>
                    </div>
                    <input type="submit" value="Login" class="btn btn-primary">

                    <p>Does not have an account?<a href="/signup"><strong>Signup</strong></a></p>
                </form>
            </div>
        </div>

        <div id="errorMessage" class="alert alert-danger text-center d-flex justify-content-center d-none"></div>
        <div id="successMessage" class="alert alert-success text-center d-flex justify-content-center  d-none"></div>
    </main>

    <footer class="p-4 bg-dark mt-3 text-light text-center fixed-bottom">
        All Rights Reserved
    </footer>

    <script>
        
document.addEventListener('DOMContentLoaded', function() {
    document.querySelector('form').addEventListener('submit', function() {
      event.preventDefault();

      var formData = new FormData(this);

      var xhr = new XMLHttpRequest();
      xhr.open('POST', '/loginPrototype', true);
      xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
      xhr.onreadystatechange = function() {
        if (xhr.readyState === 4) {
          var response = JSON.parse(xhr.responseText);
          if (xhr.status === 500) {
            document.getElementById('errorMessage').innerHTML = response.errorMessage;
            document.getElementById('successMessage').classList.add('d-none'); 
            document.getElementById('errorMessage').classList.remove('d-none');
            document.getElementById('errorMessage').classList.add('d-block');         
          } else if (xhr.status === 201) {
            document.getElementById('successMessage').innerHTML = response.successMessage;
            document.getElementById('errorMessage').classList.add('d-none');  
            document.getElementById('successMessage').classList.remove('d-none');
            document.getElementById('successMessage').classList.add('d-block');  
            setTimeout(function() {
              location.reload();
          }, 1000); 
          }
        }
      };
      xhr.send(new URLSearchParams(formData).toString());
    });
  });
    </script>
</body>
</html>